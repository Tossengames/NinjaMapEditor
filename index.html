<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Shadow Chronicles: Engine & Editor</title>
    <style>
        :root { --gold: #ffcc00; --bg: #1a1a1a; --panel: #2a2a2a; }
        body { margin: 0; padding: 0; background: var(--bg); color: white; font-family: 'Segoe UI', sans-serif; overflow: hidden; touch-action: none; }
        .screen { position: fixed; inset: 0; display: flex; flex-direction: column; align-items: center; justify-content: center; background: var(--bg); z-index: 100; text-align: center; padding: 20px; }
        .hidden { display: none !important; }
        
        /* Lists & Grids */
        .scroll-box { width: 100%; max-width: 400px; max-height: 250px; overflow-y: auto; background: #111; border: 1px solid #444; border-radius: 8px; margin: 20px 0; }
        .list-item { padding: 15px; border-bottom: 1px solid #222; cursor: pointer; background: var(--panel); margin: 5px; border-radius: 4px; }
        .item-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin: 15px 0; }
        .item-card { background: var(--panel); padding: 10px; border-radius: 8px; cursor: pointer; border: 1px solid #444; font-size: 0.75rem; }
        .item-card.active { border-color: var(--gold); background: #3a3a1a; }

        /* Loadout */
        #loadout-panel { background: #111; padding: 10px; width: 90%; max-width: 400px; border-radius: 12px; margin-bottom: 15px; border: 1px solid #444; }
        .slot { width: 50px; height: 50px; background: #222; border: 1px dashed #555; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 20px; cursor: pointer; position: relative; }
        .qty-badge { position: absolute; bottom: -5px; right: -5px; background: var(--gold); color: black; border-radius: 50%; width: 18px; height: 18px; font-size: 10px; font-weight: bold; display: flex; align-items: center; justify-content: center; border: 1px solid #111; }

        /* Editor Layout */
        #editor-screen { flex-direction: row; padding: 0; align-items: stretch; }
        #editor-sidebar { width: 220px; background: #111; border-right: 2px solid #444; padding: 10px; text-align: left; overflow-y: auto; z-index: 101; font-size: 14px; }
        input, textarea { background: #222; border: 1px solid #444; color: white; padding: 5px; width: 100%; box-sizing: border-box; margin-top: 5px; margin-bottom: 8px; border-radius: 4px; }
        
        /* Game UI */
        #toolbar { position: fixed; bottom: 0; width: 100%; height: 80px; background: rgba(0,0,0,0.9); border-top: 2px solid #444; display: flex; align-items: center; justify-content: center; gap: 8px; z-index: 10; }
        #char-circle { position: fixed; bottom: 90px; left: 15px; width: 60px; height: 60px; background: #333; border: 3px solid var(--gold); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 30px; z-index: 11; }
        
        button { padding: 10px 20px; font-weight: bold; cursor: pointer; background: var(--gold); border: none; border-radius: 5px; }
        .btn-secondary { background: #444; color: white; }
    </style>
</head>
<body>

    <div id="menu-screen" class="screen">
        <h1 style="color: var(--gold); letter-spacing: 4px;">SHADOW CHRONICLES</h1>
        <button onclick="showMissionList()">MISSIONS</button><br>
        <button onclick="openEditor()" style="background:#2d5a27; color:white;">MAP EDITOR</button><br>
        <button class="btn-secondary" onclick="alert('Rules: Green is Player, Red is Enemy, Reach Gold Exit!')">TUTORIALS</button>
    </div>

    <div id="mission-screen" class="screen hidden">
        <h2>SELECT MISSION</h2>
        <div id="level-list" class="scroll-box"></div>
        <button class="btn-secondary" onclick="showMenu()">BACK</button>
    </div>

    <div id="item-screen" class="screen hidden">
        <h2>EQUIPMENT (Max 5 Total)</h2>
        <div id="loadout-panel" style="margin: 0 auto 15px;">
            <div id="loadout-display" style="display: flex; justify-content: center; gap: 10px;"></div>
        </div>
        <div id="item-grid" class="item-grid"></div>
        <button onclick="startGame()">DEPLOY</button>
        <button class="btn-secondary" onclick="showMenu()">CANCEL</button>
    </div>

    <div id="game-screen" class="hidden">
        <canvas id="gameCanvas"></canvas>
        <div id="char-circle">üë§</div>
        <div id="toolbar">
            <div id="dynamic-items" style="display:flex; gap:8px;"></div>
            <button onclick="showMenu()" class="btn-secondary">QUIT</button>
        </div>
    </div>

    <div id="editor-screen" class="screen hidden">
        <div id="editor-sidebar">
            <h4 style="color:var(--gold); margin:5px 0;">EDITOR</h4>
            <div style="display:flex; gap:4px; margin-bottom:10px;">
                <button id="toggle-pencil" onclick="togglePencil()" style="flex:1; font-size:10px; background:#007bff; color:white;">‚úèÔ∏è PAINT</button>
                <button onclick="toggleGrid()" style="flex:1; font-size:10px; background:#666; color:white;">üåê GRID</button>
            </div>
            <label>Mission Name</label><input type="text" id="ed-name" value="New Mission">
            <label>Story</label><textarea id="ed-story"></textarea>
            <label>W x H</label>
            <div style="display:flex; gap:5px;">
                <input type="number" id="ed-cols" value="12" onchange="resetEditorGrid()">
                <input type="number" id="ed-rows" value="12" onchange="resetEditorGrid()">
            </div>
            <label>Palette</label>
            <div id="palette" style="display:grid; grid-template-columns: repeat(4, 1fr); gap:4px;"></div>
            <button onclick="exportMap()" style="width:100%; background:#28a745; color:white; margin-top:15px;">EXPORT JSON</button>
            <button onclick="showMenu()" class="btn-secondary" style="width:100%; margin-top:5px;">EXIT</button>
        </div>
        <div id="editor-viewport" style="flex-grow:1; background:#000; position:relative;">
            <canvas id="editorCanvas"></canvas>
        </div>
    </div>

    <div id="export-modal" class="screen hidden" style="background:rgba(0,0,0,0.95)">
        <h3>COPY MISSION DATA</h3>
        <textarea id="export-area" readonly style="width:90%; height:250px; font-family:monospace; font-size:10px;"></textarea>
        <button onclick="document.getElementById('export-modal').classList.add('hidden')">CLOSE</button>
    </div>

    <script src="game.js"></script>
    <script src="editor.js"></script>
</body>
</html>
